<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SciBox Interview - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</title>
    <link rel="stylesheet" href="../static/css/admin.css" />
  </head>
  <body>
    <div class="admin-container">
      <header class="admin-header">
        <div class="admin-header-content">
          <h1 class="admin-title">–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
          <button class="btn-back" onclick="goToMain()">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>
        <div class="admin-stats">
          <div class="stat-card">
            <div class="stat-number" id="total-interviews">0</div>
            <div class="stat-label">–í—Å–µ–≥–æ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–π</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="unique-directions">0</div>
            <div class="stat-label">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π</div>
          </div>
        </div>
      </header>

      <main class="admin-main">
        <div class="filters-section">
          <div class="search-box">
            <input
              type="text"
              id="search-input"
              placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û –∏–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é..."
              class="search-input"
            />
            <button class="search-btn" onclick="filterInterviews()">–ø–æ–∏—Å–∫</button>
            
          </div>
          <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–π dropdown –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º -->
    <div class="custom-dropdown" id="directionDropdown">
        <div class="dropdown-selected" id="dropdownSelected">
            <span class="selected-text">–í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</span>
            <div class="dropdown-arrow"></div>
        </div>
        <div class="dropdown-options">
            <div class="dropdown-option" data-value="">–í—Å–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
            <div class="dropdown-option" data-value="Backend Development">Backend Development</div>
            <div class="dropdown-option" data-value="Frontend Development">Frontend Development</div>
            <div class="dropdown-option" data-value="Data Science">Data Science</div>
            <div class="dropdown-option" data-value="Mobile Development">Mobile Development</div>
        </div>
    </div>
        </div>

        <div class="interviews-list" id="interviews-container">
          <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
          <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
        </div>
      </main>
    </div>

    <script>
      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let allInterviews = [];
let currentFilter = {
    search: '',
    direction: ''
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    initializePage();
});

function initializePage() {
    setupDropdown();
    setupEventListeners();
    loadInterviews();
}

function setupDropdown() {
    const dropdownSelected = document.getElementById('dropdownSelected');
    const dropdownOptions = document.querySelector('.dropdown-options');
    const options = document.querySelectorAll('.dropdown-option');

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
    dropdownSelected.addEventListener('click', function(e) {
        e.stopPropagation();
        this.classList.toggle('active');
        dropdownOptions.classList.toggle('active');
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –æ–ø—Ü–∏–π
    options.forEach(option => {
        option.addEventListener('click', function() {
            selectOption(this);
        });
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ dropdown –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    document.addEventListener('click', function() {
        dropdownSelected.classList.remove('active');
        dropdownOptions.classList.remove('active');
    });
}

function setupEventListeners() {
    // –ü–æ–∏—Å–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ —Ç–µ–∫—Å—Ç–∞
    const searchInput = document.getElementById('search-input');
    searchInput.addEventListener('input', function() {
        currentFilter.search = this.value.toLowerCase();
        applyFilters();
    });

    // –ü–æ–∏—Å–∫ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            applyFilters();
        }
    });
}

function selectOption(option) {
    const value = option.getAttribute('data-value');
    const text = option.textContent;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    const selectedText = document.querySelector('.selected-text');
    selectedText.textContent = text;
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º dropdown
    document.getElementById('dropdownSelected').classList.remove('active');
    document.querySelector('.dropdown-options').classList.remove('active');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
    document.querySelectorAll('.dropdown-option').forEach(opt => {
        opt.classList.remove('selected');
    });
    option.classList.add('selected');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º
    currentFilter.direction = value;
    applyFilters();
}

function loadInterviews() {
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç fetch –∑–∞–ø—Ä–æ—Å –∫ API
    // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º mock –¥–∞–Ω–Ω—ã–µ
    showLoading(true);
    
    setTimeout(() => {
        allInterviews = getMockInterviews();
        displayInterviews(allInterviews);
        updateStats(allInterviews);
        showLoading(false);
    }, 800);
}

function showLoading(show) {
    const container = document.getElementById('interviews-container');
    if (show) {
        container.innerHTML = '<div class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>';
    }
}

function displayInterviews(interviews) {
    const container = document.getElementById('interviews-container');
    
    if (interviews.length === 0) {
        container.innerHTML = `
            <div class="no-data">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üîç</div>
                <div>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
                <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #666;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</div>
            </div>
        `;
        return;
    }

    container.innerHTML = interviews.map(interview => createInterviewCard(interview)).join('');
}

function createInterviewCard(interview) {
    const questionnaireHtml = interview.questionnaire && Object.keys(interview.questionnaire).length > 0 
        ? `
            <div class="interview-questionnaire">
                <div class="questionnaire-title">üìã –ê–Ω–∫–µ—Ç–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:</div>
                <div class="questionnaire-items">
                    ${Object.entries(interview.questionnaire).map(([key, value]) => `
                        <div class="questionnaire-item">
                            <span class="question-label">${escapeHtml(key)}:</span>
                            <span class="question-value">${escapeHtml(String(value))}</span>
                        </div>
                    `).join('')}
                </div>
            </div>
        `
        : '';

    return `
        <div class="interview-card">
            <div class="interview-header">
                <div class="interview-name">${escapeHtml(interview.fio)}</div>
                <div class="interview-direction">${escapeHtml(interview.direction)}</div>
            </div>
            
            <div class="interview-meta">
                <div class="meta-item">
                    <span>üÜî</span>
                    <span>ID: ${interview.id}</span>
                </div>
                <div class="meta-item">
                    <span>üìÖ</span>
                    <span>${formatDate(interview.started_at)}</span>
                </div>
                <div class="meta-item">
                    <span>üîë</span>
                    <span>–°–µ—Å—Å–∏—è: ${interview.session_id ? interview.session_id.substring(0, 8) + '...' : 'N/A'}</span>
                </div>
            </div>

            ${questionnaireHtml}
        </div>
    `;
}

function applyFilters() {
    let filtered = allInterviews;
    
    // –§–∏–ª—å—Ç—Ä –ø–æ –ø–æ–∏—Å–∫–æ–≤–æ–º—É –∑–∞–ø—Ä–æ—Å—É
    if (currentFilter.search) {
        filtered = filtered.filter(interview => 
            interview.fio.toLowerCase().includes(currentFilter.search) ||
            interview.direction.toLowerCase().includes(currentFilter.search)
        );
    }
    
    // –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—é
    if (currentFilter.direction) {
        filtered = filtered.filter(interview => interview.direction === currentFilter.direction);
    }
    
    displayInterviews(filtered);
    updateStats(filtered);
}

function updateStats(interviews) {
    document.getElementById('total-interviews').textContent = interviews.length;
    
    const uniqueDirections = new Set(interviews.map(i => i.direction));
    document.getElementById('unique-directions').textContent = uniqueDirections.size;
}

function goToMain() {
    window.location.href = '/';
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function escapeHtml(unsafe) {
    if (typeof unsafe !== 'string') return unsafe;
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

function formatDate(dateString) {
    try {
        const date = new Date(dateString);
        return date.toLocaleDateString('ru-RU', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    } catch (error) {
        return '–ù–µ–≤–µ—Ä–Ω–∞—è –¥–∞—Ç–∞';
    }
}

// Mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
function getMockInterviews() {
    return [
        {
            id: 1,
            direction: "Backend Development",
            fio: "–ò–≤–∞–Ω–æ–≤ –ê–ª–µ–∫—Å–µ–π –ü–µ—Ç—Ä–æ–≤–∏—á",
            questionnaire: {
                "–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã": "3 –≥–æ–¥–∞",
                "–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è": "Python",
                "–§—Ä–µ–π–º–≤–æ—Ä–∫": "Django, FastAPI",
                "–£—Ä–æ–≤–µ–Ω—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ": "Intermediate",
                "–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è": "–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞"
            },
            started_at: "2024-01-15T10:30:00Z",
            session_id: "sess_abc123def456"
        },
        {
            id: 2,
            direction: "Frontend Development",
            fio: "–ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è –°–µ—Ä–≥–µ–µ–≤–Ω–∞",
            questionnaire: {
                "–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã": "2 –≥–æ–¥–∞",
                "–û—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–µ–∫": "React, TypeScript",
                "–£—Ä–æ–≤–µ–Ω—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ": "Upper-Intermediate",
                "–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ–º—ã–π –ø–æ–¥—Ö–æ–¥": "Component-based architecture",
                "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ": "Experience with WebGL"
            },
            started_at: "2024-01-16T14:20:00Z",
            session_id: "sess_ghi789jkl012"
        },
        {
            id: 3,
            direction: "Data Science",
            fio: "–°–∏–¥–æ—Ä–æ–≤ –î–º–∏—Ç—Ä–∏–π –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á",
            questionnaire: {
                "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ": "–ú–∞–≥–∏—Å—Ç—Ä –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö –Ω–∞—É–∫",
                "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è": "Machine Learning",
                "–û–ø—ã—Ç –≤ ML": "4 –≥–æ–¥–∞",
                "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏": "Python, PyTorch, Scikit-learn",
                "–ü—Ä–æ–µ–∫—Ç—ã": "Computer Vision, NLP"
            },
            started_at: "2024-01-17T09:15:00Z",
            session_id: "sess_mno345pqr678"
        },
        {
            id: 4,
            direction: "Mobile Development",
            fio: "–ö–æ–∑–ª–æ–≤–∞ –ê–Ω–Ω–∞ –ò–≥–æ—Ä–µ–≤–Ω–∞",
            questionnaire: {
                "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞": "iOS & Android",
                "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏": "Swift, Kotlin, React Native",
                "–û–ø—ã—Ç": "3 –≥–æ–¥–∞",
                "–ü—É–±–ª–∏–∫–∞—Ü–∏–∏": "5 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ App Store",
                "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è": "UI/UX –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
            },
            started_at: "2024-01-18T11:45:00Z",
            session_id: "sess_xyz123abc456"
        },
        {
            id: 5,
            direction: "Backend Development",
            fio: "–°–º–∏—Ä–Ω–æ–≤ –ê–Ω–¥—Ä–µ–π –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á",
            questionnaire: {
                "–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã": "5 –ª–µ—Ç",
                "–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è": "Java",
                "–§—Ä–µ–π–º–≤–æ—Ä–∫": "Spring Boot",
                "–£—Ä–æ–≤–µ–Ω—å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ": "Advanced",
                "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö": "PostgreSQL, Redis"
            },
            started_at: "2024-01-19T13:20:00Z",
            session_id: "sess_def456ghi789"
        }
    ];
}
    </script>
  </body>
</html>
