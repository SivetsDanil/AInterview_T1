<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SciBox Interview - Собеседование</title>
    <link rel="stylesheet" href="../static/css/styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">SciBox Interview</div>
            <div class="header-controls">
                <div class="progress-container">
                    <div class="progress-info">
                        <span>Прогресс: </span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="timer" id="timer">45:00</div>
                </div>
                <button class="btn btn-danger" onclick="endInterview()">Завершить</button>
            </div>
        </header>

        <div class="interview-container">
            <!-- Левая панель - Задача -->
            <div class="problem-panel">
                <div class="panel-tabs">
                    <div class="tab active">Задача</div>
                </div>
                <div class="panel-content">
                    <div class="problem-content">
                        <h3>Название задачи</h3>
                        <p>Описание задачи будет загружено здесь...</p>
                        <div class="code-block">
                            Пример ввода/вывода будет здесь...
                        </div>
                    </div>
                    <button class="btn btn-primary run-tests-btn" onclick="runTests()">
                        Запустить тесты
                    </button>
                </div>
            </div>

            <!-- Центральная панель - Редактор -->
            <div class="editor-panel">
                <div class="editor-header">
        <!-- Кастомный dropdown -->
        <div class="custom-dropdown" id="languageDropdown">
            <div class="dropdown-selected" id="dropdownSelected">
                <span class="selected-text">Python</span>
                <div class="dropdown-arrow"></div>
            </div>
            <div class="dropdown-options">
                <div class="dropdown-option" data-value="python">Python</div>
                <div class="dropdown-option" data-value="javascript">JavaScript</div>
                <div class="dropdown-option" data-value="java">Java</div>
                <div class="dropdown-option" data-value="cpp">C++</div>
            </div>
        </div>
    </div>
                <div class="editor-area">
                    <textarea class="code-editor" placeholder="// Напишите ваш код здесь...">
// Пример кода
function solution() {
    return true;
}
                    </textarea>
                </div>
                <div class="console-panel">
                    <div class="console-content" id="consoleOutput">> Результаты тестов появятся здесь...</div>
                </div>
            </div>

            <!-- Правая панель - Чат -->
            <div class="chat-panel">
                <div class="chat-header">
                    AI Интервьюер
                </div>
                <div class="chat-messages" id="chatMessages">
                    <div class="message message-ai">
                        Здравствуйте! Я ваш AI-интервьюер. Начнем собеседование...
                    </div>
                </div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" placeholder="Введите ваше сообщение...">
                    <button class="btn btn-primary send-btn" onclick="sendMessage()">Отправить</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно окончания времени -->
    <div id="timeUpModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-icon">⏰</div>
            <h2>Время вышло!</h2>
            <p>Собеседование завершено. Ваши результаты сохраняются...</p>
            <div class="modal-progress">
                <div class="modal-progress-bar">
                    <div class="modal-progress-fill"></div>
                </div>
                <span class="modal-countdown">Перенаправление через: <span id="redirectCountdown">5</span>с</span>
            </div>
            <button class="btn btn-primary" onclick="redirectNow()">Перейти к результатам</button>
        </div>
    </div>
    <script src="/static/js/interview.js"></script>
   <script>
    // Переменные для управления
    let timerInterval;
    let totalTime = 45 * 60; // 45 минут в секундах
    let timeLeft = totalTime;

    // Прогресс по задачам
    let totalTasks = 4; // Всего задач в собеседовании
    let completedTasks = 0; // Решенные задачи
    let currentTaskProgress = 0; // Прогресс текущей задачи (0-100%)

    // Запуск при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
        startTimer();
        updateProgressBar();
        initLanguageDropdown();
    });

    // Функции для кастомного dropdown
    function initLanguageDropdown() {
        const dropdown = document.getElementById('languageDropdown');
        const selected = document.getElementById('dropdownSelected');
        const options = dropdown.querySelector('.dropdown-options');
        const arrow = dropdown.querySelector('.dropdown-arrow');

        // Обработчик клика на выбранный элемент
        selected.addEventListener('click', function(e) {
            e.stopPropagation();
            const isActive = selected.classList.contains('active');

            // Закрыть все открытые dropdown
            closeAllDropdowns();

            if (!isActive) {
                selected.classList.add('active');
                options.classList.add('show');
                arrow.classList.add('rotated');
                createDropdownOverlay();
            }
        });

        // Обработчики для опций
        const optionElements = options.querySelectorAll('.dropdown-option');
        optionElements.forEach(option => {
            option.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                const text = this.textContent;

                // Обновляем выбранный элемент
                selected.querySelector('.selected-text').textContent = text;

                // Обновляем выделение в dropdown
                updateLanguageSelection(value);

                // Закрываем dropdown
                closeDropdown();
            });
        });
    }

    function createDropdownOverlay() {
        const overlay = document.createElement('div');
        overlay.className = 'dropdown-overlay';
        overlay.style.display = 'block';
        document.body.appendChild(overlay);

        overlay.addEventListener('click', closeAllDropdowns);
    }

    function closeDropdown() {
        const dropdown = document.getElementById('languageDropdown');
        const selected = document.getElementById('dropdownSelected');
        const options = dropdown.querySelector('.dropdown-options');
        const arrow = dropdown.querySelector('.dropdown-arrow');

        selected.classList.remove('active');
        options.classList.remove('show');
        arrow.classList.remove('rotated');

        // Удаляем overlay
        const overlay = document.querySelector('.dropdown-overlay');
        if (overlay) {
            overlay.remove();
        }
    }

    function closeAllDropdowns() {
        closeDropdown();
    }

    function updateLanguageSelection(selectedValue) {
        const options = document.querySelectorAll('.dropdown-option');
        options.forEach(option => {
            option.classList.remove('selected');
            if (option.getAttribute('data-value') === selectedValue) {
                option.classList.add('selected');
            }
        });

    // Функции таймера
    function startTimer() {
        updateTimerDisplay();

        timerInterval = setInterval(function() {
            timeLeft--;
            updateTimerDisplay();

            // Изменение цвета при малом времени
            const timerElement = document.getElementById('timer');
            if (timeLeft <= 300) { // 5 минут
                timerElement.style.color = '#EF4444';
                if (timeLeft <= 60) {
                    timerElement.style.animation = 'pulse 1s infinite';
                }
            }

            // Проверка окончания времени
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                showTimeUpModal();
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        document.getElementById('timer').textContent =
            `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }

    // Функции прогресса задач
    function updateProgressBar() {
        // Общий прогресс = завершенные задачи + прогресс текущей задачи
        const overallProgress = (completedTasks / totalTasks) * 100 +
                              (currentTaskProgress / totalTasks);

        const progressFill = document.getElementById('progressFill');

        progressFill.style.width = Math.min(overallProgress, 100) + '%';

        // Меняем цвет прогресс-бара в зависимости от прогресса
        if (overallProgress >= 75) {
            progressFill.style.background = 'linear-gradient(90deg, #00E5A8, #00AAE5)';
        } else if (overallProgress >= 50) {
            progressFill.style.background = 'linear-gradient(90deg, #F59E0B, #00AAE5)';
        } else {
            progressFill.style.background = 'linear-gradient(90deg, #00AAE5, #0090C5)';
        }
    }

    function completeTask() {
        completedTasks++;
        currentTaskProgress = 0;
        updateProgressBar();

        // Уведомление в чат
        addMessage(`Задача ${completedTasks} завершена! Переходим к следующей...`, 'ai');

        // Если все задачи решены
        if (completedTasks >= totalTasks) {
            setTimeout(() => {
                addMessage('Поздравляю! Вы решили все задачи собеседования.', 'ai');
                setTimeout(() => {
                    endInterviewSuccess();
                }, 2000);
            }, 1000);
        }
    }

    function updateTaskProgress(progress) {
        currentTaskProgress = progress;
        updateProgressBar();
    }

    function endInterviewSuccess() {
        clearInterval(timerInterval);
        alert('Все задачи решены! Переходим к результатам...');
        window.location.href = 'results';
    }

    // Модальное окно
    function showTimeUpModal() {
        const modal = document.getElementById('timeUpModal');
        modal.style.display = 'flex';

        let countdown = 5;
        const countdownElement = document.getElementById('redirectCountdown');

        const countdownInterval = setInterval(() => {
            countdownElement.textContent = countdown;
            if (countdown-- <= 0) {
                clearInterval(countdownInterval);
                redirectToResults();
            }
        }, 1000);
    }

        function redirectNow() {
            redirectToResults();
        }

        function redirectToResults() {
            window.location.href = 'results';
        }

        // Остальные функции...
        function sendMessage() {
            const input = document.querySelector('.chat-input');
            const message = input.value.trim();
            if (message) {
                addMessage(message, 'user');
                input.value = '';
                
                // Заглушка ответа AI
                setTimeout(() => {
                    addMessage('Спасибо за ваш ответ! Продолжайте работу над задачей.', 'ai');
                }, 500);
            }
        }
        
        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            messageElement.className = `message message-${sender}`;
            messageElement.textContent = text;
            messagesContainer.appendChild(messageElement);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Функция runTests() определена в interview.js
        
        function endInterview() {
            if (confirm('Завершить собеседование?')) {
                clearInterval(timerInterval);
                window.location.href = 'results';
            }
        }
    </script>
    <script src="/static/js/interview.js"></script>
</body>
</html>






